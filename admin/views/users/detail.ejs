<%- include("../partials/header") %>

<div class="container-fluid">
  <div class="row">
    <div class="col-2">
      <%- include("../partials/sidebar") %>
    </div>
    <div class="col-10 my-4">
      <h1>ðŸ”Ž DÃ©tail utilisateur</h1>

      <!-- Infos de base -->
      <ul class="list-group mb-3">
        <li class="list-group-item"><strong>Nom :</strong> <%= user.name %></li>
        <li class="list-group-item"><strong>Email :</strong> <%= user.email %></li>
        <li class="list-group-item"><strong>RÃ´le actuel :</strong> <%= user.role %></li>
      </ul>

      <!-- Livres associÃ©s -->
      <h3>ðŸ“š Livres associÃ©s</h3>
      <ul class="list-group mb-3">
        <% if (user.books && user.books.length > 0) { %>
          <% user.books.forEach(book => { %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <%= book.title %>
              <div>
                <!-- Retirer -->
                <form action="/admin/user/<%= user.id %>/book/<%= book.id %>/remove" method="POST" style="display:inline;">
                  <button type="submit" class="btn btn-danger btn-sm">Retirer</button>
                </form>
                <!-- Statut lecture -->
                <form action="/admin/user/<%= user.id %>/book/<%= book.id %>/status" method="POST" style="display:inline;">
                  <input type="hidden" name="toRead" value="<%= book.UserBook.toRead ? 0 : 1 %>">
                  <button type="submit" class="btn btn-secondary btn-sm">
                    <%= book.UserBook.toRead ? "Marquer comme lu" : "Ã€ lire" %>
                  </button>
                </form>
              </div>
            </li>
          <% }) %>
        <% } else { %>
          <li class="list-group-item">Aucun livre associÃ©</li>
        <% } %>
      </ul>

      <!-- Ajouter un livre -->
      <h3>âž• Ajouter un livre</h3>
      <!-- âš ï¸ Ici il faut coller Ã  ta route: /admin/user/:userId/book/:bookId -->
      <!-- Donc on met bookId dans l'URL, pas dans le body -->
      <form action="/admin/user/<%= user.id %>/book/<%= books[0]?.id %>/add" method="POST">
        <select name="bookId" class="form-select" onchange="this.form.action='/admin/user/<%= user.id %>/book/' + this.value + '/add'">
          <% books.forEach(book => { %>
            <option value="<%= book.id %>"><%= book.title %></option>
          <% }) %>
        </select>
        <button type="submit" class="btn btn-primary">Associer</button>
      </form>

      <!-- Navigation -->
      <div class="mt-4">
        <a href="/admin/user/<%= user.id %>/edit" class="btn btn-warning">Modifier infos</a>
        <a href="/admin/users" class="btn btn-secondary">Retour</a>
      </div>
    </div>
  </div>
</div>

<%- include("../partials/footer") %>